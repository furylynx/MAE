#!/bin/bash

#TODO specify for each library
LIB="libmae.la"
RELEASE='0:9:0'
AUTHOR='furylynx'



# makefile generator code

LIBLA=$(echo $LIB | sed 's/\./_/g')

echo '# autogenerated Makefile.am for automake' > Makefile.am 
echo '# created by prepare_autotools script\n\n' >> Makefile.am 

echo 'pkgconfigdir = $(libdir)/pkgconfig' >> Makefile.am 
echo 'pkgconfig_DATA = libmae.pc' >> Makefile.am 

echo 'SUBDIRS = include \n' >> Makefile.am 

echo 'lib_LTLIBRARIES = '$LIB' \n' >> Makefile.am 
echo -n $LIBLA'_SOURCES = ' >> Makefile.am 

# find all source files in the folders src/ and wrappers/ recursively and print them to the Makefile.am
find . -type f \( -path "./src/*" -o -path "./wrappers/*" \)  \( -name *.cpp -o -name *.cxx -o -name *.c -o -name *.cc -o -name *.hh \) | sed 's/\.\///g' | sed ':a;N;$!ba;s/\n/ \\\n/g' >> Makefile.am 
#find src/ -type f \( -name *.cpp -o -name *.cxx -o -name *.c -o -name *.cc -o -name *.h -o -name *.hpp \) | sed 's/\.\///g' | sed 's/$/ \\/' >> src/Makefile.am
#find . -type f \( -path "./wrappers/*" \)  \( -name *.cpp -o -name *.cxx -o -name *.c -o -name *.cc -o -name *.h -o -name *.hpp \) | sed 's/\.\//\.\.\//g' | sed ':a;N;$!ba;s/\n/ \\\n/g' >> src/Makefile.am 

echo '\n'$LIBLA'_LIBADD = $(OPENCV_LIBS) $(LIBXMLXX_LIBS)' >> Makefile.am 
echo $LIBLA'_CPPFLAGS = $(OPENCV_CFLAGS) $(LIBXMLXX_CFLAGS)' >> Makefile.am 
echo $LIBLA'_LDFLAGS = -shared -version-info '$RELEASE >> Makefile.am 
echo '\nACLOCAL_AMFLAGS = -I m4' >> Makefile.am 




# update makefile for includes...

echo -n '\nnobase_include_HEADERS = ' > include/Makefile.am 

# find all header files in the folder include/ recursively and print them to the Makefile.am
find . -type f -path "./include/*"  \( -name *.hpp -o -name *.h \) | sed 's/\.\/include\///g' | sed ':a;N;$!ba;s/\n/ \\\n/g' >> include/Makefile.am 



# create a .pc.in file for pkg config
echo 'prefix=@prefix@' > libmae.pc.in
echo 'exec_prefix=@exec_prefix@' >> libmae.pc.in
echo 'libdir=@libdir@' >> libmae.pc.in
echo 'includedir=@includedir@' >> libmae.pc.in

echo 'Name: libmae' >> libmae.pc.in
echo 'Description: Base library of the Movement Analysis Engine (MAE) for analyzing movement using depth sensors and Labanotation.' >> libmae.pc.in
echo 'URL: https://github.com/furylynx/MAE' >> libmae.pc.in
echo 'Version: @VERSION@' >> libmae.pc.in
echo 'Requires: opencv >= 2.4.8, libxml++-2.6 >= 2.6' >> libmae.pc.in
echo 'Libs: -L${libdir} -lmae' >> libmae.pc.in
echo 'Cflags: -I${includedir}' >> libmae.pc.in

